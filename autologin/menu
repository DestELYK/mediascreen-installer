if [ -z $DISPLAY ] && [ $(tty) = /dev/tty1 ]; then
  echo "Waiting for connection..."
  while ! ping -c 1 -W 1 google.com >/dev/null; do
    sleep 1
  done

  echo "Downloading Media Screen Installer..."

  wget -q 'https://raw.githubusercontent.com/DestELYK/mediascreen-installer/main/install.sh' -O install.sh || {
    echo "Download failed. Please enter the URL:"
    read -r new_url
    wget -q "$new_url" -O install.sh || {
      echo "Download failed again. Please check the URL and try again later."
      exit 1
    }
  }

  chmod +x install.sh

  echo "Installing Media Screen components..."
  if ! sudo ./install.sh; then
    echo "Installation failed. Please check the error messages above for details."
    exit 1
  fi

  echo "Launching Media Screen with full installation..."

  if ! sudo ms-util; then
    echo ""
    echo "ERROR: Failed to run ms-util!"
    echo "Please check the error messages above for details."
    echo ""
    read -p "Press Enter to continue or Ctrl+C to exit..." 
    exit 1
  fi
fi